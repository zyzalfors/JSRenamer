<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JS Renamer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/voca/1.4.0/voca.min.js"></script>
</head>
<body style="background-color: #ADD8E6;">
JS Renamer 1.1.0
<hr>
<input type="text" id="dirPath" style="width:400px" placeholder="Enter directory path">
<br><br>
<input type="text" id="filter" style="width:400px" placeholder="Enter regular expression filter">
<input type="checkbox" id="caseInsFilter"><label for="caseInsFilter">Case insensitive match</label>
<br><br>
<input type="button" style="width:200px" value="Open directory" onclick="openDirectory()">
<input type="button" style="width:200px" value="Sort file names" onclick="sortOldNames()">
<input type="button" style="width:200px" value="About" onclick="showAbout()">
<br><br>
<textarea wrap="off" onscroll="scrollNew()" id="oldNames" rows="30" cols="80" placeholder="- Enter path of directory containing files to be renamed&#10;- Press 'Sort file names' and sort names of files to be renamed"></textarea>
<textarea wrap="off" onscroll="scrollOld()" id="newNames" rows="30" cols="80" placeholder="- Enter personalized new names&#10;or&#10;- Set methods to be used to generate new names. Method data are stored as JSON&#10;- Press 'Generate new names' and sort new names"></textarea>
<textarea wrap="off" id="methods" rows="30" cols="35" readonly>{ "methods" : [] }</textarea>
<br><br>
<input type="button" style="width:200px" value="Clear old names" onclick="clearArea(this.value)">
<input type="button" style="width:200px" value="Clear new names" onclick="clearArea(this.value)">
<input type="button" style="width:200px" value="Clear methods" onclick="clearArea(this.value)">
<input type="button" style="width:200px" value="Reset" onclick="location.reload()">
<br><br>
<input type="button" style="width:200px" value="Generate new names" onclick="getNewNames()">
<input type="button" style="width:200px" value="Rename files" onclick="renameFiles()">
<input type="checkbox" id="openDir"><label for="openDir">Open directory after renaming process</label>
<hr>
<input type="text" id="length" style="width:200px" placeholder="Enter length">
<input type="text" id="padder" style="width:200px" placeholder="Enter padder text">
<br><br>
<input type="text" id="number" style="width:200px" placeholder="Enter starting number">
<input type="text" id="increment" style="width:200px" placeholder="Enter increment">
<input type="checkbox" id="prependNum"><label for="prependNum">Prepend number</label>
<input type="checkbox" id="appendNum"><label for="appendNum">Append number</label>
<br><br>
<input type="text" id="regex" style="width:200px" placeholder="Enter regular expression">
<input type="text" id="replacement" style="width:200px" placeholder="Enter replacement">
<input type="checkbox" id="global"><label for="global">Global match</label>
<input type="checkbox" id="caseIns"><label for="caseIns">Case insensitive match</label>
<br><br>
<input type="checkbox" id="modName"><label for="modName">Modify name</label>
<input type="checkbox" id="modExt"><label for="modExt">Modify extension</label>
<br><br>
<input type="button" style="width:200px" value="Upper case" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Lower case" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Inverse case" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Alternating case 1" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Alternating case 2" onclick="addMethod(this.value)">
<br><br>
<input type="button" style="width:200px" value="Capitalized case" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Latinise" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Reverse" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Trim" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Replace" onclick="addMethod(this.value)">
<br><br>
<input type="button" style="width:200px" value="Numbering" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Pad right" onclick="addMethod(this.value)">
<input type="button" style="width:200px" value="Pad left" onclick="addMethod(this.value)">
<script>

let object = new ActiveXObject("Scripting.FileSystemObject");

function showAbout()
{
 var about = "JS Renamer\nAuthor: Al Armato\nVersion: 1.1.0\n\n" + 
            "This program is free software: you can redistribute it and/or modify\n" + 
       		"it under the terms of the GNU General Public License as published by\n" + 
       		"the Free Software Foundation, either version 3 of the License, or\n" + 
       		"(at your option) any later version.\n\n" + 
       		"This program is distributed in the hope that it will be useful,\n" + 
       		"but WITHOUT ANY WARRANTY; without even the implied warranty of\n" + 
       		"MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n" + 
       		"GNU General Public License for more details.\n\n" + 
       		"Visit https://www.gnu.org/licenses.";
 alert(about);
}

function openDirectory()
{
 let dirPath = (document.getElementById("dirPath").value.trim() + "\\").replace(/\\+/g,"\\");
 if(object.FolderExists(dirPath) && dirPath !== "\\")
 {
  window.open(dirPath);
 }
 else
 {
  alert("Directory not found");
 }
}

function scrollNew()
{
 document.getElementById("newNames").scrollTop = document.getElementById("oldNames").scrollTop;
 document.getElementById("newNames").scrollLeft = document.getElementById("oldNames").scrollLeft;
}

function scrollOld()
{
 document.getElementById("oldNames").scrollTop = document.getElementById("newNames").scrollTop;
 document.getElementById("oldNames").scrollLeft = document.getElementById("newNames").scrollLeft;
}

function getName(fileName)
{
 let pos = fileName.lastIndexOf(".");
 return (pos !== -1) ? fileName.substring(0, pos) : fileName;
}

function getExtension(fileName)
{
 let pos = fileName.lastIndexOf(".");
 return (pos !== -1) ? fileName.substring(pos + 1) : "";
}

function toAlternatingCase1(text)
{
 let newText = "";
 let toUp = true;
 for (let i = 0; i < text.length; i++)
 {
  if (text[i].toUpperCase() !== text[i].toLowerCase())
  {
   if(toUp === true)
   {
    newText += text[i].toUpperCase();
    toUp = false;
   }
   else
   {
    newText += text[i].toLowerCase();
    toUp = true;
   }
  }
  else
  {
   newText += text[i];
  }
 }
 return newText;
}

function toAlternatingCase2(text)
{
 let newText = "";
 let toUp = false;
 for (let i = 0; i < text.length; i++)
 {
  if (text[i].toUpperCase() !== text[i].toLowerCase())
  {
   if(toUp === true)
   {
    newText += text[i].toUpperCase();
    toUp = false;
   }
   else
   {
    newText += text[i].toLowerCase();
    toUp = true;
   }
  }
  else
  {
   newText += text[i];
  }
 }
 return newText;
}

function padText(text, padder, length, leftOrRight)
{
 let paddedTextChars = v.graphemes(text);
 let padderChars = v.graphemes(padder);
 let nPaddings = Math.ceil((length - paddedTextChars.length)/padderChars.length);
 if(!leftOrRight)
 {
  for(let i = 0; i < nPaddings; i++)
  {
   paddedTextChars = paddedTextChars.concat(padderChars);
  }
 }
 else
 {
  for(let i = 0; i < nPaddings; i++)
  {
   padderChars = padderChars.concat(padderChars);
  }
  paddedTextChars = padderChars.concat(paddedTextChars);
 }  
 let nCharsToBeRemoved = paddedTextChars.length - length;
 if(!leftOrRight)
 {
  while( nCharsToBeRemoved > 0 ) 
  {
   paddedTextChars.pop();
   nCharsToBeRemoved--;
  }
 }
 else
 {
  while( nCharsToBeRemoved > 0 ) 
  {
   paddedTextChars.shift();
   nCharsToBeRemoved--;
  }
 }
 let paddedText = "";
 for(let i = 0; i < paddedTextChars.length; i++)
 {
  paddedText += paddedTextChars[i];
 }
 return paddedText;
}

function toCapitalizedCase(text)
{
 let newText = "";
 let toUp = true;
 for (let i = 0; i < text.length; i++)
 {
  if(text[i].search(/\s/) === -1)
  {
   if (toUp === true) 
   {
	newText += text[i].toUpperCase();
	toUp = false;
   }
   else
   {
	newText += text[i].toLowerCase();
   }
  }
  else
  {
   newText += text[i];
   toUp = true;      
  }
 }
 return newText;
}

function numbering(oldFileName, appendNum, prependNum, num)
{
 let name = getName(oldFileName);
 let ext = getExtension(oldFileName);
 if(appendNum)
 {
  name = name + num;
 }
 if(prependNum)
 {
  name = num + name;
 }
 if(ext !== "")
 {
  return name + "." + ext;
 }
 return name;
}

function replaceWithMethod(oldFileName, regExp, method, modName, modExt)
{
 let name = getName(oldFileName);
 let ext = getExtension(oldFileName);
 if(modExt && ext !== "")
 {
  ext = ext.replace(regExp, function(match) { return method(match); });
 }
 if(modName)
 {
  name = name.replace(regExp, function(match) { return method(match); });
 }
 if(ext !== "")
 {
  return name + "." + ext;
 }
 return name;
}

function replaceWithPad(oldFileName, regExp, method, padder, length, leftOrRight, modName, modExt)
{
 let name = getName(oldFileName);
 let ext = getExtension(oldFileName);
 if(modExt && ext !== "")
 {
  ext = ext.replace(regExp, function(match) { return method(match, padder, length, leftOrRight); });
 }
 if(modName)
 {
  name = name.replace(regExp, function(match) { return method(match, padder, length, leftOrRight); });
 }
 if(ext !== "")
 {
  return name + "." + ext;
 }
 return name;
}

function replaceWithReplacement(oldFileName, regExp, replacement, modName, modExt)
{
 let name = getName(oldFileName);
 let ext = getExtension(oldFileName);
 if(modExt && ext !== "")
 {
  ext = ext.replace(regExp,replacement);
 }
 if(modName)
 {
  name = name.replace(regExp,replacement);
 }
 if(ext !== "")
 {
  return name + "." + ext;
 }
 return name;
}

function clearArea(filter)
{
 if(filter === "Clear new names")
 {
  document.getElementById("newNames").value = "";
 }
 if(filter === "Clear old names")
 {
  document.getElementById("oldNames").value = "";
 }
 if(filter === "Clear methods")
 {
  document.getElementById("methods").value = "{ \"methods\" : [] }";
 } 
}

function addMethod(filter)
{
 let json = JSON.parse(document.getElementById("methods").value);
 let num = parseInt(document.getElementById("number").value);
 let increment = parseInt(document.getElementById("increment").value);
 let appendNum = document.getElementById("appendNum").checked;
 let prependNum = document.getElementById("prependNum").checked;
 let regex = document.getElementById("regex").value;
 let replacement = document.getElementById("replacement").value;
 let modExt = document.getElementById("modExt").checked;
 let modName = document.getElementById("modName").checked;
 let global = document.getElementById("global").checked;
 let caseIns = document.getElementById("caseIns").checked;
 let length = parseInt(document.getElementById("length").value);
 let padder = document.getElementById("padder").value;
 if(filter === "Numbering")
 {
  json.methods.push({
                     "name": filter, 
                     "startingNumber": num,
					 "increment" : increment, 
					 "prepend": prependNum, 
					 "append": appendNum
					});
 }
 else if(filter === "Replace")
 {
  json.methods.push({
                     "name": filter, 
					 "regularExpression": regex,
					 "global" : global, 
					 "caseInsensitive" : caseIns, 
					 "replacement" : replacement, 
					 "modifyName" : modName, 
					 "modifyExtension" : modExt
					});
 }
 else if(filter === "Pad right" || filter === "Pad left")
 {
  json.methods.push({
                     "name": filter, 
					 "regularExpression": regex,
					 "global" : global, 
					 "caseInsensitive" : caseIns, 
					 "padderText" : padder,
					 "length" : length,
					 "modifyName" : modName, 
					 "modifyExtension" : modExt
					});
 }
 else
 {
  json.methods.push({
                     "name": filter, 
					 "regularExpression": regex, 
					 "global" : global, 
					 "caseInsensitive" : caseIns, 
					 "modifyName" : modName, 
					 "modifyExtension" : modExt
					});
 }
 document.getElementById("methods").value = JSON.stringify(json,null,1);
}

function getRegex(regex, global, caseIns)
{
 try
 {
  if(global && caseIns)
  {
   return new RegExp(regex,"gi");
  }
  if(global && !caseIns)
  {
   return new RegExp(regex,"g");								
  }
  if(!global && caseIns)
  {
   return new RegExp(regex,"i");								
  }
  return new RegExp(regex);
 }
 catch(error)
 {
  return new RegExp(".+");
 }
}

function getNewName(methodName, oldFileName, regex, global, caseIns, replacement, num, increment, appendNum, prependNum, padder, length, modName, modExt)
{
 let regExp = getRegex(regex, global, caseIns);
 if(methodName === "Numbering")
 {
  num += increment;
  return numbering(oldFileName, appendNum, prependNum, num)
 }
 if(methodName === "Replace")
 {
  return replaceWithReplacement(oldFileName, regExp, replacement, modName, modExt);
 }
 if(methodName === "Upper case")
 {
  return replaceWithMethod(oldFileName, regExp, v.upperCase, modName, modExt);
 }
 if(methodName === "Lower case")
 {
  return replaceWithMethod(oldFileName, regExp, v.lowerCase, modName, modExt);
 }
 if(methodName === "Inverse case")
 {
  return replaceWithMethod(oldFileName, regExp, v.swapCase, modName, modExt);
 }
 if(methodName === "Alternating case 1")
 {
  return replaceWithMethod(oldFileName, regExp, toAlternatingCase1, modName, modExt);
 }
 if(methodName === "Alternating case 2")
 {
  return replaceWithMethod(oldFileName, regExp, toAlternatingCase2, modName, modExt);
 }
 if(methodName === "Capitalized case")
 {
  return replaceWithMethod(oldFileName, regExp, toCapitalizedCase, modName, modExt);
 }
 if(methodName === "Latinise")
 {
  return replaceWithMethod(oldFileName, regExp, v.latinise, modName, modExt);
 }
 if(methodName === "Reverse")
 {
  return replaceWithMethod(oldFileName, regExp, v.reverseGrapheme, modName, modExt);
 }
 if(methodName === "Trim")
 {
  return replaceWithMethod(oldFileName, regExp, v.trim, modName, modExt);
 }
 if(methodName === "Pad right")
 {
  return replaceWithPad(oldFileName, regExp, padText, padder, length, false, modName, modExt);
 }
 if(methodName === "Pad left")
 {
  return replaceWithPad(oldFileName, regExp, padText, padder, length, true, modName, modExt);
 }
 return oldFileName;
}

function getNewNames()
{
 let oldNames = document.getElementById("oldNames").value.split("\n").filter(function (text){ return text.search(/[^\s]/g) !== -1; });
 let methods = JSON.parse(document.getElementById("methods").value).methods;
 let newNamesList = "";
 for(let i = 0; i < oldNames.length; i++)
 {
  let newName = oldNames[i];
  for(let j = 0; j < methods.length; j++)
  {
   let num = methods[j].startingNumber;
   let increment = methods[j].increment;
   let appendNum = methods[j].append;
   let prependNum = methods[j].prepend;
   let regex = methods[j].regularExpression;
   let replacement = methods[j].replacement;
   let modExt = methods[j].modifyExtension;
   let modName = methods[j].modifyName;
   let global = methods[j].global;
   let caseIns = methods[j].caseInsensitive;
   let padder = methods[j].padderText;
   let length = methods[j].length;
   newName = getNewName(methods[j].name, newName, regex, global, caseIns, replacement, num, i*increment, appendNum, prependNum, padder, length, modName, modExt);
  }
  newNamesList += newName + "\n";
 }
 document.getElementById("newNames").value = newNamesList.slice(0, -1);
}

function includes(container, content)
{
 return (container !== null) ? (container.indexOf(content) !== -1) : false;
}

function sortOldNames()
{
 let dirPath = (document.getElementById("dirPath").value.trim() + "\\").replace(/\\+/g,"\\");
 let caseInsFilter = document.getElementById("caseInsFilter").checked;
 let regExp = getRegex(document.getElementById("filter").value, false, caseInsFilter);
 if(!object.FolderExists(dirPath) || dirPath === "\\")
 {
  alert("Directory not found");
 }
 else
 {
  let files = new Enumerator(object.GetFolder(dirPath).Files);
  let names = [];
  for(;!files.atEnd();files.moveNext())
  {
   let name = files.item().Name;
   if(includes(name.match(regExp),name))
   {
    names.push(name);
   }
  }
  let collator = new Intl.Collator(undefined, {numeric: true, sensitivity: 'base'});
  names.sort(collator.compare);
  let namesList = "";
  for(let i = 0; i < names.length; i++)
  {
   namesList += names[i] + "\n";
  }
  document.getElementById("oldNames").value = namesList.slice(0, -1);
  if(namesList === "")
  {
   alert("No file found");
  }
 }
}

function renameFiles()
{
 let openDir = document.getElementById("openDir").checked;
 let dirPath = (document.getElementById("dirPath").value.trim() + "\\").replace(/\\+/g,"\\");
 let oldNames = document.getElementById("oldNames").value.split("\n").filter(function (text){ return text.search(/[^\s]/g) !== -1; });
 let newNames = document.getElementById("newNames").value.split("\n").filter(function (text){ return text.search(/[^\s]/g) !== -1; });
 let n = 0;
 for(let i = 0; i < oldNames.length; i++)
 {
  if(oldNames[i] !== undefined && newNames[i] !== undefined && newNames[i] !== oldNames[i])
  {
   if(object.FileExists(dirPath + oldNames[i]))
   {
    n++;
    object.MoveFile(dirPath + oldNames[i], dirPath + newNames[i]);
   }
  }
 }
 alert(n + " file(s) renamed");
 if (object.FolderExists(dirPath) && dirPath !== "\\" && openDir)
 {
  window.open(dirPath);
 }
}

</script>
</body>
</html>